# Batch Borrow Request Fields

## üìã Overview

A batch borrow request creates **multiple individual borrow requests** (one for each item in the cart) that share the same `batchId` and `batchSize`. Each request is stored separately in the `/borrow_requests` path with the batch information.

---

## üóÑÔ∏è Database Structure

**Path:** `/borrow_requests/{requestId}`

Each item in the batch creates a separate request with the following fields:

---

## üìä Field List

### **Batch Identification Fields**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `batchId` | `String` | ‚úÖ Yes | Unique identifier shared by all items in the same batch. Used to group requests together. |
| `batchSize` | `int` | ‚úÖ Yes | Total number of items in this batch. Same value for all requests in the batch. |

### **Request Identification Fields**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `requestId` | `String` | ‚úÖ Yes | Unique identifier for this specific request. Auto-generated by Firebase. |
| `userId` | `String` | ‚úÖ Yes | User ID of the student making the request. |
| `userEmail` | `String` | ‚úÖ Yes | Email address of the student making the request. |

### **Equipment Information Fields**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `itemId` | `String` | ‚úÖ Yes | Unique identifier of the equipment item. |
| `categoryId` | `String` | ‚úÖ Yes | Unique identifier of the equipment category. |
| `itemName` | `String` | ‚úÖ Yes | Name of the equipment item. |
| `categoryName` | `String` | ‚úÖ Yes | Name of the equipment category. |
| `itemNo` | `String` | ‚úÖ Yes | Item number. Format: `LAB-{first5CharsOfItemId}` (e.g., "LAB-ABCDE"). |
| `quantity` | `int` | ‚úÖ Yes | Quantity of items requested for this specific equipment. |

### **Laboratory Fields**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `laboratory` | `String` | ‚úÖ Yes | Display name of the laboratory (e.g., "Chemistry Laboratory"). Used for backward compatibility. |
| `labId` | `String` | ‚úÖ Yes | Laboratory code (e.g., "LAB001"). |
| `labRecordId` | `String` | ‚úÖ Yes | Firebase record ID of the laboratory. |

### **Schedule Fields**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `dateToBeUsed` | `String` | ‚úÖ Yes | ISO 8601 date string when the equipment will be used. Format: `"2024-01-15T00:00:00.000Z"`. |
| `dateToReturn` | `String` | ‚úÖ Yes | ISO 8601 date string when the equipment should be returned. Format: `"2024-01-20T00:00:00.000Z"`. |

### **Adviser Fields**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `adviserName` | `String` | ‚úÖ Yes | Name of the adviser/teacher. |
| `adviserId` | `String` | ‚úÖ Yes | User ID of the adviser/teacher. |

### **Status Fields**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `status` | `String` | ‚úÖ Yes | Request status. Initial value: `"pending"`. Possible values: `pending`, `approved`, `rejected`, `released`, `returned`. |
| `requestedAt` | `String` | ‚úÖ Yes | ISO 8601 timestamp when the request was created. Format: `"2024-01-10T10:30:00.000Z"`. |

### **Optional Fields**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `signature` | `String` | ‚ùå No | Base64-encoded JSON string of the signature. Included when user signs the batch request. |
| `processedAt` | `String` | ‚ùå No | ISO 8601 timestamp when the request was processed (approved/rejected). Added by web admin. |
| `processedBy` | `String` | ‚ùå No | User ID of the person who processed the request. Added by web admin. |
| `releasedAt` | `String` | ‚ùå No | ISO 8601 timestamp when the item was released. Added by web admin. |
| `releasedBy` | `String` | ‚ùå No | User ID of the person who released the item. Added by web admin. |
| `returnedAt` | `String` | ‚ùå No | ISO 8601 timestamp when the item was returned. Added by student or web admin. |

---

## üìù Example Request Data

```json
{
  "batchId": "batch-uuid-12345",
  "batchSize": 3,
  "requestId": "request-uuid-67890",
  "userId": "student-user-id",
  "userEmail": "student@example.com",
  "itemId": "equipment-item-id-1",
  "categoryId": "category-id-1",
  "itemName": "Microscope",
  "categoryName": "Laboratory Equipment",
  "itemNo": "LAB-ABCDE",
  "quantity": 2,
  "laboratory": "Chemistry Laboratory",
  "labId": "LAB001",
  "labRecordId": "firebase-lab-record-id",
  "dateToBeUsed": "2024-01-15T00:00:00.000Z",
  "dateToReturn": "2024-01-20T00:00:00.000Z",
  "adviserName": "Dr. Smith",
  "adviserId": "teacher-user-id",
  "status": "pending",
  "requestedAt": "2024-01-10T10:30:00.000Z"
}
```

---

## üîÑ Batch Request Flow

### 1. **User Adds Items to Cart**
- Multiple items can be added to the cart
- Each item has its own `itemId`, `categoryId`, `itemName`, `categoryName`, and `quantity`

### 2. **User Fills Batch Form**
- Selects **one laboratory** (applies to all items in batch)
- Selects **one date range** (applies to all items in batch)
- Selects **one adviser** (applies to all items in batch)

### 3. **Submission Creates Multiple Requests**
- Creates **one `batchId`** (shared by all items)
- Calculates **`batchSize`** (total number of items)
- Creates **one request per item** in `/borrow_requests`
- Each request has:
  - Same `batchId` and `batchSize`
  - Same `laboratory`, `labId`, `labRecordId`
  - Same `dateToBeUsed` and `dateToReturn`
  - Same `adviserName` and `adviserId`
  - Same `userId` and `userEmail`
  - Different `itemId`, `categoryId`, `itemName`, `categoryName`, `itemNo`, `quantity`
  - Different `requestId` (unique for each request)

---

## üîç Key Differences: Batch vs Single Request

### **Batch Request**
- ‚úÖ Has `batchId` field
- ‚úÖ Has `batchSize` field
- ‚úÖ Has `signature` field (optional, included when user signs)
- Multiple requests created (one per item)
- All requests share same `batchId`, `batchSize`, `laboratory`, `dates`, `adviser`, `signature`

### **Single Request**
- ‚ùå Does NOT have `batchId` field
- ‚ùå Does NOT have `batchSize` field
- ‚úÖ Has `signature` field (optional)
- One request created
- User enters item details manually

---

## üìä Field Summary

### **Total Fields: 20**

**Required Fields (16):**
1. `batchId`
2. `batchSize`
3. `requestId`
4. `userId`
5. `userEmail`
6. `itemId`
7. `categoryId`
8. `itemName`
9. `categoryName`
10. `itemNo`
11. `quantity`
12. `laboratory`
13. `labId`
14. `labRecordId`
15. `dateToBeUsed`
16. `dateToReturn`
17. `adviserName`
18. `adviserId`
19. `status`
20. `requestedAt`

**Optional Fields (5):**
1. `signature` - Not included in batch requests
2. `processedAt` - Added by web admin
3. `processedBy` - Added by web admin
4. `releasedAt` - Added by web admin
5. `releasedBy` - Added by web admin
6. `returnedAt` - Added by student or web admin

---

## üîó Related Files

- `lib/home/batch_borrow_form_page.dart` - Batch request form and submission
- `lib/home/service/form_service.dart` - Single request submission (for comparison)
- `lib/home/service/cart_service.dart` - Cart management
- `lib/home/service/laboratory_service.dart` - Laboratory data

---

## üìù Notes

1. **Batch Grouping:** All requests with the same `batchId` belong to the same batch.

2. **Batch Size:** The `batchSize` field indicates how many items are in the batch. Useful for displaying batch information.

3. **Signature:** Batch requests include a signature field when the user signs the batch request. The same signature is included in all requests within the batch.

4. **Same Values:** All requests in a batch share the same:
   - `batchId`
   - `batchSize`
   - `laboratory`, `labId`, `labRecordId`
   - `dateToBeUsed`, `dateToReturn`
   - `adviserName`, `adviserId`
   - `userId`, `userEmail`
   - `signature` (when provided)

5. **Different Values:** Each request in a batch has different:
   - `requestId` (unique)
   - `itemId`, `categoryId`
   - `itemName`, `categoryName`
   - `itemNo`
   - `quantity`

6. **Status Management:** Each request in a batch can have a different status (e.g., some approved, some rejected).

7. **Quantity Management:** The `quantity_borrowed` field is NOT set by the mobile app. It should be managed by the web admin on approval.

---

**Last Updated:** 2024-01-XX  
**Status:** Current Implementation

